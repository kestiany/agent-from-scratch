# 🧠 代码分析 Agent（Week 4）

> 一个**可控、可解释、不胡乱编结论**的代码分析 Agent  
> 当前仅支持 **Java 单文件后端代码分析**

🌐 **语言**：简体中文 | [English](README.md)

---

## 这是什么？

这是一个**单一职责的代码分析 Agent**，  
它只在**明确的能力边界内**对 Java 后端代码进行静态分析。

通过显式的**状态机驱动 + 控制决策机制**，确保：

- 不胡乱推断
- 不假装确定
- 在信息不足时明确说明限制

---

## 为什么要做这个 Agent？

现有 AI 代码分析工具常见问题：

1. 信息不足时依然给出确定结论  
2. 输出不可解释、无法追溯  
3. 执行失败后失控继续  

本项目的核心理念是：

> **少做事，但每一步都可信、可复现、可解释。**

---

## 设计原则

- ✅ 单任务 Agent（只做代码分析）
- ✅ 状态驱动执行（State 是唯一事实来源）
- ✅ 失败可见、可追踪
- ✅ 不确定性显式建模
- ❌ 不猜业务意图
- ❌ 不做项目级分析
- ❌ 不运行代码

---

## 当前支持范围（Week 4）

### ✅ 支持

- Java 单文件后端代码
- 方法级 / 类级风险分析
- 不确定风险标记（confidence = low）
- 结构化分析报告
- CLI 方式运行

### ❌ 不支持

- 项目级依赖分析
- 跨文件调用关系
- 运行时行为推断
- 性能或安全扫描

---

## Agent 执行流程

````

理解代码
↓
风险识别
↓
风险确认 / 降级
↓
报告生成

```

每一步都包含：

- 执行
- 评估
- 反思
- 控制决策（继续 / 重试 / 重规划）

---

## 核心架构

### AgentState —— 状态是一等公民

所有 Agent 行为都必须通过状态变化体现。

---

### AgentKernel —— 执行与控制中枢

```

think → action → evaluate → reflect → decision

````

约束规则：

- evaluate 不可跳过
- reflect 必须执行
- 决策集合有限且明确

---

### 风险模型

```json
{
  "title": "潜在空指针风险",
  "severity": "high",
  "confidence": "medium",
  "position": "Class.method()"
}
````

> **severity 描述影响程度**
> **confidence 描述判断确定性**

---

## 失败与不确定性策略

### 何时返回「信息不足」

* 代码过于简单
* 无可分析结构
* 上下文缺失严重

### 何时中止任务

* 输入非代码
* 多次失败且无法恢复

### 何时降低置信度

* 依赖隐含约定
* 推断而非确定判断
* 无法验证上下文

---

## CLI 使用方式

```bash
python src/main.py
```

---

## 项目结构

```
agent-from-scratch/
├── agent/
├── src/
├── README.md
└── README.zh-CN.md
```

---

## Week 4 完成标准

* [x] 状态驱动执行
* [x] 全流程可追溯
* [x] 不确定性显式输出
* [x] 失败可控
* [x] 可本地演示

---

## 一句话总结

> **这是一个宁可保守，也不胡说的 Agent。**

